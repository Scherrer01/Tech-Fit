-- MECANICA SOMATIVA
-- BANCO DE DADOS MECANICA

CREATE DATABASE MECANICA;
USE MECANICA;

-- CLIENTE 
CREATE TABLE CLIENTE (
    ID_CLIENTE INT AUTO_INCREMENT PRIMARY KEY,
    NOME_CLIENTE VARCHAR(100) NOT NULL,
    CPF_CLIENTE VARCHAR(14) UNIQUE,
    TELEFONE_CLIENTE VARCHAR(15),
    EMAIL VARCHAR(100),
    ENDERECO VARCHAR(255)
);

-- FUNCIONARIO
CREATE TABLE FUNCIONARIO (
    ID_FUNCIONARIO INT AUTO_INCREMENT PRIMARY KEY,
    NOME_FUNCIONARIO VARCHAR(100) NOT NULL,
    CPF_FUNCIONARIO VARCHAR(14) UNIQUE NOT NULL,
    TELEFONE_FUNCIONARIO VARCHAR(15)
);

-- SERVICO 
CREATE TABLE SERVICO (
    ID_SERVICO INT AUTO_INCREMENT PRIMARY KEY,
    MAO_DE_OBRA DECIMAL(10,2) NOT NULL,
    NOME_SERVICO VARCHAR(100) NOT NULL,
    TEMPO TIME,
    DESCRICAO_SERVICO TEXT
);

-- VEICULO
CREATE TABLE VEICULO (
    ID_VEICULO INT AUTO_INCREMENT PRIMARY KEY,
    MODELO VARCHAR(50) NOT NULL,
    MARCA VARCHAR(50) NOT NULL,
    ID_CLIENTE INT NOT NULL,
    ANO INT,
    PLACA VARCHAR(10) UNIQUE NOT NULL,
    FOREIGN KEY(ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE)
);

-- PECAS 
CREATE TABLE PECAS (
    ID_PECA INT AUTO_INCREMENT PRIMARY KEY,
    NOME_PECA VARCHAR(100) NOT NULL,
    PRECO DECIMAL(10,2) NOT NULL,
    QUANTIDADE INT,
    DESCRICAO_PECA TEXT
);

-- ORDERM DE SERVIÇO
CREATE TABLE OS (
    ID_OS INT AUTO_INCREMENT PRIMARY KEY,
    ID_VEICULO INT NOT NULL,
    DATA_ABERTURA DATE,
    DATA_CONCLUSAO DATE,
    OBS TEXT,
    TOTAL DECIMAL(10,2) NOT NULL,
    FOREIGN KEY(ID_VEICULO) REFERENCES VEICULO(ID_VEICULO)
);

-- ATENDE 
CREATE TABLE ATENDE (
    ID_OS INT NOT NULL,
    ID_FUNCIONARIO INT NOT NULL,
    PRIMARY KEY(ID_OS, ID_FUNCIONARIO),
    FOREIGN KEY(ID_OS) REFERENCES OS(ID_OS),
    FOREIGN KEY(ID_FUNCIONARIO) REFERENCES FUNCIONARIO(ID_FUNCIONARIO)
);

-- UTILIZA
CREATE TABLE UTILIZA (
    ID_OS INT NOT NULL,
    ID_PECA INT NOT NULL,
    QUANTIDADE INT DEFAULT 1,
    PRIMARY KEY(ID_OS, ID_PECA),
    FOREIGN KEY(ID_OS) REFERENCES OS(ID_OS),
    FOREIGN KEY(ID_PECA) REFERENCES PECAS(ID_PECA)
);

-- REALIZA
CREATE TABLE REALIZA (
    ID_OS INT NOT NULL,
    ID_SERVICO INT NOT NULL,
    PRIMARY KEY(ID_OS, ID_SERVICO),
    FOREIGN KEY(ID_OS) REFERENCES OS(ID_OS),
    FOREIGN KEY(ID_SERVICO) REFERENCES SERVICO(ID_SERVICO)
);
-- ==========================================================================

-- INSERTS
INSERT INTO CLIENTE (NOME_CLIENTE, CPF_CLIENTE, TELEFONE_CLIENTE, EMAIL, ENDERECO) VALUES
('João Silva', '123.456.789-00', '(11) 9999-8888', 'joao.silva@email.com', 'Rua das Flores, 123 - São Paulo/SP'),
('Maria Santos', '987.654.321-00', '(11) 7777-6666', 'maria.santos@email.com', 'Avenida Paulista, 456 - São Paulo/SP'),
('Carlos Oliveira', '111.222.333-44', '(11) 5555-4444', 'carlos.oliveira@email.com', 'Rua Augusta, 789 - São Paulo/SP');

INSERT INTO FUNCIONARIO (NOME_FUNCIONARIO, CPF_FUNCIONARIO, TELEFONE_FUNCIONARIO) VALUES
('Pedro Almeida', '222.333.444-55', '(11) 8888-7777'),
('Ana Costa', '333.444.555-66', '(11) 6666-5555'),
('Roberto Lima', '444.555.666-77', '(11) 4444-3333');

INSERT INTO SERVICO (MAO_DE_OBRA, NOME_SERVICO, TEMPO, DESCRICAO_SERVICO) VALUES
(120.00, 'Troca de Óleo e Filtro', '00:45:00', 'Troca de óleo do motor e filtro de óleo'),
(80.00, 'Alinhamento e Balanceamento', '01:00:00', 'Alinhamento das rodas e balanceamento'),
(200.00, 'Troca de Pastilhas de Freio', '01:30:00', 'Troca das pastilhas de freio dianteiras');

INSERT INTO VEICULO (MODELO, MARCA, ID_CLIENTE, ANO, PLACA) VALUES
('Golf', 'Volkswagen', 1, 2020, 'ABC1D23'),
('Onix', 'Chevrolet', 2, 2021, 'DEF4G56'),
('Uno', 'Fiat', 3, 2019, 'GHI7J89');

INSERT INTO PECAS (NOME_PECA, PRECO, QUANTIDADE, DESCRICAO_PECA) VALUES
('Óleo Motor 5W30', 25.00, 50, 'Óleo sintético 5W30 1L'),
('Filtro de Óleo', 20.00, 30, 'Filtro de óleo para motores 1.0 a 2.0'),
('Pastilha de Freio', 75.00, 20, 'Pastilha de freio dianteira');

INSERT INTO OS (ID_VEICULO, DATA_ABERTURA, DATA_CONCLUSAO, OBS, TOTAL) VALUES
(1, '2024-01-15', '2024-01-15', 'Veículo com ruído no motor', 320.00),
(2, '2024-01-16', NULL, 'Revisão periódica - em andamento', 0.00),
(3, '2024-01-17', '2024-01-17', 'Problema no sistema de freios', 275.00);

INSERT INTO ATENDE (ID_OS, ID_FUNCIONARIO) VALUES
(1, 1),
(1, 2),
(2, 3),
(3, 1),
(3, 3);

INSERT INTO UTILIZA (ID_OS, ID_PECA, QUANTIDADE) VALUES
(1, 1, 4),
(1, 2, 1),
(3, 3, 1);

INSERT INTO REALIZA (ID_OS, ID_SERVICO) VALUES
(1, 1),
(1, 2),
(3, 3);

